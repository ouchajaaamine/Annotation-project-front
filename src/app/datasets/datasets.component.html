<div class="datasets-layout">
  <!-- Sidebar (identique à admin dashboard) -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <i class="fas fa-edit"></i>
      </div>
      <h1 class="sidebar-title">Annotation Platform</h1>
    </div>
    <nav class="sidebar-menu">
      <a href="/admin/dashboard" routerLinkActive="active" class="sidebar-menu-item">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </a>
      <a href="/admin/annotateurs" routerLinkActive="active" class="sidebar-menu-item">
        <i class="fas fa-users"></i> Annotateurs
      </a>
      <a href="/admin/datasets" routerLinkActive="active" class="sidebar-menu-item active">
        <i class="fas fa-database"></i>
        <span>Datasets</span>
      </a>
      <a href="#" class="sidebar-menu-item">
        <i class="fas fa-chart-bar"></i>
        <span>Statistiques</span>
      </a>
      <a href="#" class="sidebar-menu-item">
        <i class="fas fa-cog"></i>
        <span>Paramètres</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <div class="user-profile">
        <div class="user-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="user-info">
          <h4 class="user-name">Admin User</h4>
          <p class="user-role">Administrateur</p>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="navbar">
      <div class="navbar-left">
        <h2 class="page-title">Datasets Management</h2>
        <p class="subtitle">Manage and organize your datasets</p>
      </div>
      <div class="navbar-right">
        <button class="add-btn" (click)="openAddModal()">+ Add Dataset</button>
      </div>
    </header>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card primary">
        <div class="stat-info">
          <p class="stat-label">COMPLETED DATASETS</p>
          <h3 class="stat-value">{{ completedCount }}</h3>
        </div>
        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
      </div>
      <div class="stat-card secondary">
        <div class="stat-info">
          <p class="stat-label">IN PROGRESS DATASETS</p>
          <h3 class="stat-value">{{ inProgressCount }}</h3>
        </div>
        <div class="stat-icon"><i class="fas fa-wave-square"></i></div>
      </div>
      <div class="stat-card tertiary">
        <div class="stat-info">
          <p class="stat-label">UNASSIGNED DATASETS</p>
          <h3 class="stat-value">{{ unassignedCount }}</h3>
        </div>
        <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="search-filter-container">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          placeholder="Search datasets..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearch()"
        />
      </div>
      <div class="filter-box">
        <button class="filter-btn" (click)="toggleFilterMenu()">
          <i class="fas fa-filter"></i> Filters
          <i class="fas fa-chevron-down" [class.rotated]="showFilterMenu"></i>
        </button>
        <div class="filter-menu" *ngIf="showFilterMenu">
          <!-- Ajoute ici tes options de filtre -->
          <div class="filter-section">
            <h4>Status</h4>
            <div class="filter-options">
              <label class="filter-option">
                <input type="checkbox" [(ngModel)]="filters.completed" (ngModelChange)="onFilterChange()">
                <span>Completed</span>
              </label>
              <label class="filter-option">
                <input type="checkbox" [(ngModel)]="filters.inProgress" (ngModelChange)="onFilterChange()">
                <span>In Progress</span>
              </label>
              <label class="filter-option">
                <input type="checkbox" [(ngModel)]="filters.unassigned" (ngModelChange)="onFilterChange()">
                <span>Unassigned</span>
              </label>
            </div>
          </div>
          <div class="filter-actions">
            <button class="clear-btn" (click)="clearFilters()">Clear All</button>
            <button class="apply-btn" (click)="applyFilters()">Apply</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Datasets Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th style="width: 5%;">#</th>
            <th style="width: 30%;">Name</th>
            <th style="width: 20%;">Description</th>
            <th style="width: 25%;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let dataset of filteredDatasets; let i = index">
            <td>{{ dataset.id }}</td>
            <td>{{ dataset.name }}</td>
            <td>{{ dataset.description }}</td>
            <td>
              <a class="icon-btn" title="View" [routerLink]="['/admin/datasets/details', dataset.id]">
                <i class="fas fa-eye"></i>
              </a>
              <button class="icon-btn" title="Assign" (click)="openAssignModal(dataset.id)"><i class="fas fa-user-plus"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
      <!-- Pagination -->
      <div class="pagination">
        <button class="pagination-btn" [disabled]="currentPage === 1" (click)="prevPage()">Previous</button>
        <span>Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">Next</button>
      </div>
    </div>
    <!-- Footer -->
    <footer class="footer">
      <span>© 2025 Annotation Platform. All rights reserved.</span>
      <span class="footer-links">
        <a href="#">Terms</a>
        <a href="#">Privacy</a>
        <a href="#">Contact</a>
      </span>
    </footer>
  </main>
</div>

<!-- MODAL: Add Dataset -->
<div class="modal-overlay" *ngIf="showAddModal">
  <div class="modal add-dataset-modal">
    <div class="modal-header">
      <h2>Add New Dataset</h2>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <form (ngSubmit)="submitAddDataset()" enctype="multipart/form-data">
      <div class="modal-body">
        <div class="form-group">
          <label for="datasetName">Name <span class="required">*</span></label>
          <input id="datasetName" type="text" [(ngModel)]="newDataset.name" name="name" required />
        </div>
        <div class="form-group">
          <label for="datasetDescription">Description <span class="required">*</span></label>
          <textarea id="datasetDescription" [(ngModel)]="newDataset.description" name="description" required></textarea>
        </div>
        <div class="form-group">
          <label for="datasetClasses">Classes <span class="required">*</span></label>
          <input id="datasetClasses" type="text" [(ngModel)]="newDataset.classesRaw" name="classesRaw" placeholder="positive;negative;neutral" required />
          <small>Separate classes with semicolons (;)</small>
        </div>
        <div class="form-group">
          <label for="datasetFile">Excel File <span class="required">*</span></label>
          <input id="datasetFile" type="file" (change)="onFileSelected($event)" accept=".xls,.xlsx" required />
        </div>
        <div class="error-message" *ngIf="addError">{{ addError }}</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="cancel-btn" (click)="closeAddModal()">Cancel</button>
        <button type="submit" class="submit-btn" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="loader"></span>
          Add Dataset
        </button>
      </div>
    </form>
  </div>
</div>
<!-- END MODAL -->

<!-- MODAL: Assign Annotators -->
<div class="modal-overlay" *ngIf="showAssignModal">
  <div class="modal assign-modal">
    <div class="modal-header">
      <h2><i class="fas fa-user-plus"></i> Assigner des annotateurs</h2>
      <button class="close-btn" (click)="closeAssignModal()">&times;</button>
    </div>
    <form (ngSubmit)="submitAssign()">
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Annotateurs <span class="required">*</span></label>
          <div class="annotators-list">
            <div class="annotator-item" *ngFor="let a of assignAnnotators">
              <label class="annotator-label" *ngIf="a.id !== undefined">
                <input type="checkbox"
                  [checked]="assignSelectedAnnotators.includes(a.id!)"
                  (change)="onAnnotatorCheckboxChange($event, a.id!)">
                <span class="annotator-info">
                  <span class="annotator-name">{{a.prenom}} {{a.nom}}</span>
                  <span class="annotator-login">({{a.login}})</span>
                </span>
              </label>
            </div>
          </div>
          <small class="form-hint">Sélectionnez au moins 3 annotateurs actifs</small>
        </div>
        <div class="form-group">
          <label class="form-label">Date limite <span class="required">*</span></label>
          <input type="date" 
                 [(ngModel)]="assignDeadline" 
                 name="assignDeadline" 
                 class="form-control"
                 [min]="today"
                 required />
          <small class="form-hint">Choisissez une date limite pour l'annotation</small>
        </div>
        <div class="error-message" *ngIf="assignError">
          <i class="fas fa-exclamation-circle"></i> {{ assignError }}
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeAssignModal()">
          <i class="fas fa-times"></i> Annuler
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="assignLoading">
          <i class="fas" [class.fa-spinner]="assignLoading" [class.fa-check]="!assignLoading"></i>
          {{ assignLoading ? 'Assignation en cours...' : 'Assigner' }}
        </button>
      </div>
    </form>
  </div>
</div>
<!-- END MODAL: Assign Annotators -->
